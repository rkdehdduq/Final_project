<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>투자 성향 평가</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #333;
            color: #fff;
            margin: 0;
            padding: 0;
        }

        h1 {
            text-align: center;
            margin: 20px;
            font-size: 36px;
            color: #007bff;
        }

        form {
            max-width: 600px;
            margin: auto;
            background-color: #444;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        h3 {
            margin-top: 20px;
            margin-bottom: 10px;
            color: #bbb;
        }

        label {
            display: block;
            margin: 10px 0;
            cursor: pointer;
            font-size: 18px;
        }

        input[type="radio"], input[type="checkbox"] {
            margin-right: 10px;
        }

        button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }

        @media (max-width: 600px) {
            form {
                padding: 15px;
            }

            h1 {
                font-size: 28px;
            }

            h3 {
                font-size: 20px;
            }

            button {
                font-size: 16px;
            }}

        /* Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0, 0, 0, 0.8); /* Black w/ opacity */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            display: flex; /* Flexbox for centering */
        }

        .modal-content {
            
            background-color: #444;
            margin: auto; /* 수평 중앙 정렬 */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* 화면 크기에 따라 조정 */
            max-width: 600px; /* 최대 너비 설정 */
            color: #fff;
            text-align: center;
            position: absolute; /* 절대 위치 */
            top: 50%; /* 수직 중앙 위치 */
            left: 50%; /* 수평 중앙 위치 */
            transform: translate(-50%, -50%); /* 중앙 정렬 */
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: white;
            text-decoration: none;
            cursor: pointer;
        }
        /* FundAd 스타일 추가 */
        .fundad {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #007bff;
            font-size: 24px;
            cursor: pointer;
            font-weight: bold;
        }
            
        
    </style>
</head>
<body>
        <!-- FundAd 텍스트 추가 -->
    <div class="fundad" onclick="location.href='/'">FundAd</div>
    <h1>투자 성향 평가</h1>
    <form method="POST">
        <h3>1. 당신의 연령은 어떻게 됩니까?</h3>
        <label>
            나이 입력 (0-120세) <input type="number" name="question1" id="ageInput" value='' required>
        </label> 
        <script>
            let age; // 전역 변수로 선언
            document.getElementByName("question1").addEventListener("input", function() {
                age = parseInt(this.value); // 나이를 입력받아 age 변수에 저장
            });
        </script>

        <h3>2. 투자하고자 하는 자금의 투자 가능 기간은 얼마나 됩니까?</h3>
        <label><input type="radio" name="question2" value="0" required> 6개월 이내</label>
        <label><input type="radio" name="question2" value="5"> 6개월 ~ 1년 이내</label>
        <label><input type="radio" name="question2" value="10"> 1년 ~ 2년 이내</label>
        <label><input type="radio" name="question2" value="15"> 2년 ~ 3년 이내</label>
        <label><input type="radio" name="question2" value="20"> 3년 이상</label>

        <h3>3. 다음 중 투자경험과 가장 가까운 것은 어느 것입니까? (중복가능)</h3>
        <label><input type="checkbox" name="question3" value="5"> 은행 예금/적금 등</label>
        <label><input type="checkbox" name="question3" value="10"> 금융채, 신용도가 높은 회사채 등</label>
        <label><input type="checkbox" name="question3" value="15"> 신용도 중간 등급의 회사채 등</label>
        <label><input type="checkbox" name="question3" value="20"> 신용도가 낮은 회사채, 주식 등</label>
        <label><input type="checkbox" name="question3" value="20"> ELW, 선물옵션 등</label>

        <h3>4. 금융상품 투자에 대한 본인의 수준은 어느 정도라고 생각하십니까?</h3>
        <label><input type="radio" name="question4" value="0" required> 매우 낮은 수준</label>
        <label><input type="radio" name="question4" value="5"> 낮은 수준</label>
        <label><input type="radio" name="question4" value="10"> 높은 수준</label>
        <label><input type="radio" name="question4" value="15"> 매우 높은 수준</label>

        <h3>5. 현재 투자하고자 하는 자금은 전체 금융자산 중 어느 정도의 비중을 차지합니까?</h3>
        <label><input type="radio" name="question5" value="0" required> 10% 이내</label>
        <label><input type="radio" name="question5" value="5"> 10% ~ 20% 이내</label>
        <label><input type="radio" name="question5" value="10"> 20% ~ 30% 이내</label>
        <label><input type="radio" name="question5" value="15"> 30% ~ 40% 이내</label>
        <label><input type="radio" name="question5" value="20"> 40% 초과</label>

        <h3>6. 다음 중 당신의 수입원을 가장 잘 나타내고 있는 것은 어느 것입니까?</h3>
        <label><input type="radio" name="question6" value="10" required> 현재 일정한 수입이 발생</label>
        <label><input type="radio" name="question6" value="5"> 현재 일정한 수입이 발생하나 불안정</label>
        <label><input type="radio" name="question6" value="0"> 현재 일정한 수입원이 없음</label>

        <h3>7. 만약 투자원금에 손실이 발생할 경우 감수할 수 있는 손실 수준은?</h3>
        <label><input type="radio" name="question7" value="0" required> 무슨 일이 있어도 투자원금은 보전</label>
        <label><input type="radio" name="question7" value="5"> 10% 미만 손실 감수</label>
        <label><input type="radio" name="question7" value="10"> 20% 미만 손실 감수</label>
        <label><input type="radio" name="question7" value="20"> 위험이 높아도 상관없음</label>

        <button type="button" id="submitBtn">제출</button>
    </form>

    <!-- Modal -->
    <div id="resultModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>테스트 결과</h2>
            <p id="resultScore"></p>
            <p id="resultRiskLevel"></p>
            <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                <button onclick="saveResult()" style="background-color: #28a745; padding: 10px 8px; font-size: 14px;">저장</button>
                <button onclick="closeModal()" style="padding: 10px 8px; font-size: 14px;">다시 검사하기</button>
            </div>
        </div>
    </div>

    <script>
        const RISK_LEVEL_MAPPING = {
            "안정형 (Stable)": 5,
            "안정추구형 (Stable Seeking)": 4,
            "위험 중립형 (Risk Neutral)": 3,
            "적극 투자형 (Aggressive Investor)": 2,
            "공격투자형 (Aggressive Investor)": 1
        };
        function openModal(score, riskLevel) {
            document.getElementById("resultScore").innerText = "점수: " + score;
            document.getElementById("resultRiskLevel").innerText = "위험 수준: " + riskLevel;
            document.getElementById("resultModal").style.display = "block";
        }

        function closeModal() {
            document.getElementById("resultModal").style.display = "none";
        }

        function saveResult() {
            const riskLevelDiv = document.getElementById("resultRiskLevel");
            if (riskLevelDiv) {
                const riskLevelText = riskLevelDiv.textContent.replace("위험 수준: ", "");
                const riskLevel = RISK_LEVEL_MAPPING[riskLevelText] || null; // 매핑된 숫자값으로 변환
                const username = localStorage.getItem('username');
                const age = document.getElementById('ageInput').value;
                

                // 서버로 결과 전송
                fetch('/api/save_retest_result', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json' // JSON 형식으로 전송
                    },
                    body: JSON.stringify({
                        username: username,
                        riskLevel: riskLevel, // 위험 수준
                        riskLevelText: riskLevelText, // 점수  
                        age: age, // 나이
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('결과 저장에 실패했습니다.');
                    }
                    return response.json();
                })
                .then(data => {
                    alert(data.message); // 성공 메시지 표시
                    closeModal(); // 모달 닫기
                    window.parent.closeTest2Popup(); // test2 팝업 닫기
                    window.parent.openAccountModal(); // 계정 정보 모달 다시 열기
                })
                .catch(error => {
                    alert(error.message); // 오류 메시지 표시
                });
            } else {
                console.error("resultRiskLevel 요소가 존재하지 않습니다.");
            }
        }

        // 제출 버튼 클릭 시 동작
        document.getElementById("submitBtn").onclick = function() {
            var formData = new FormData(document.querySelector("form"));

            fetch('/re_test', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('테스트를 진행해주세요');
                }
                return response.json();
            })
            .then(data => {
                openModal(data.score, data.riskLevelText); // 모달 열기
            })
            .catch(error => {
                alert(error.message); // 오류 메시지 표시
            });
        };

    </script>

</body>
</html>
